<template>
<Navbar />   
    <div>
      <div class="card cart" >
        <div class="">
          <div class="intro py-3 text-center">
            <h1>ORDER IN PROGRESS</h1>
            <h6>Please check your email to confirm your order</h6>
            <div class="pt-5">
              <svg style="max-width: 525px; height: auto;" viewBox="0 0 525 287" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0)">
<path d="M20.8424 274.857C35.1732 285.181 53.7448 285.7 71.6963 284.431C74.203 284.254 76.692 284.047 79.1579 283.823C79.1727 283.819 79.1923 283.821 79.2074 283.817C79.326 283.805 79.4447 283.794 79.5581 283.787C80.067 283.74 80.5762 283.692 81.0804 283.644L80.9613 283.872L80.5875 284.577C80.7218 284.341 80.8561 284.11 80.9904 283.874C81.03 283.803 81.0742 283.732 81.1135 283.661C85.7639 275.569 90.3763 267.179 91.5529 257.938C92.769 248.347 89.3512 237.486 80.9096 232.771C79.8025 232.155 78.6301 231.664 77.4141 231.307C76.9092 231.154 76.3975 231.03 75.88 230.919C72.714 230.216 69.4179 230.369 66.3306 231.363C63.2433 232.356 60.4763 234.153 58.314 236.57C56.1517 238.987 54.6722 241.937 54.0276 245.115C53.3831 248.293 53.5967 251.586 54.6466 254.655C47.4896 247.316 48.8246 235.41 51.2935 225.46C53.7671 215.51 56.7616 204.439 51.7305 195.502C48.9338 190.528 44.0157 187.441 38.4963 186.198C38.327 186.161 38.1579 186.125 37.9882 186.093C31.4121 184.761 24.5755 185.959 18.844 189.448C8.29051 196.098 2.87011 208.708 1.11087 221.059C-1.72359 240.936 4.54911 263.119 20.8424 274.857Z" fill="#F1F1F1"/>
<path d="M25.4695 242.995C25.8855 247.379 26.9387 251.679 28.5958 255.76C30.1229 259.37 32.1813 262.733 34.7027 265.735C39.8534 271.931 46.664 276.589 54.0605 279.693C59.7161 282.009 65.6417 283.601 71.6966 284.431C74.2033 284.254 76.6923 284.047 79.1582 283.823C79.1731 283.819 79.1926 283.821 79.2078 283.817C79.3263 283.805 79.445 283.794 79.5584 283.787C80.0674 283.74 80.5766 283.692 81.0808 283.644L80.9617 283.871L80.5878 284.577C80.7222 284.341 80.8564 284.11 80.9908 283.874C81.0303 283.803 81.0746 283.732 81.1138 283.661C76.5745 279.139 73.1854 273.594 71.2304 267.492C69.2753 261.389 68.8114 254.908 69.8774 248.589C70.9929 242.315 73.5754 236.394 77.4144 231.307C76.9095 231.154 76.3978 231.03 75.8803 230.92C74.4213 232.914 73.1416 235.034 72.056 237.254C68.1606 245.171 66.9179 254.132 68.5117 262.81C69.9934 270.663 73.685 277.93 79.1529 283.759C78.6741 283.725 78.1907 283.686 77.7176 283.643C68.7567 282.884 59.8141 280.957 51.6864 277.011C44.7391 273.72 38.7077 268.771 34.1234 262.601C29.201 255.812 27.0319 247.646 26.6593 239.347C26.2643 230.462 27.4171 221.421 29.4449 212.78C31.5154 203.922 34.6621 195.35 38.8149 187.256C38.9077 187.073 38.9265 186.861 38.8672 186.664C38.808 186.467 38.6752 186.3 38.4965 186.198C38.3475 186.098 38.165 186.06 37.9884 186.093C37.9021 186.116 37.822 186.158 37.7541 186.217C37.6863 186.275 37.6324 186.347 37.5965 186.429C37.0842 187.429 36.5815 188.43 36.0978 189.441C32.0698 197.868 29.1043 206.763 27.2694 215.921C25.4881 224.756 24.5373 233.998 25.4695 242.995Z" fill="white"/>
<path d="M207.186 286.914H0.542371C0.398525 286.914 0.26057 286.857 0.158856 286.755C0.057142 286.653 0 286.515 0 286.371C0 286.227 0.057142 286.09 0.158856 285.988C0.26057 285.886 0.398525 285.829 0.542371 285.829H207.186C207.329 285.829 207.467 285.886 207.569 285.988C207.671 286.09 207.728 286.227 207.728 286.371C207.728 286.515 207.671 286.653 207.569 286.755C207.467 286.857 207.329 286.914 207.186 286.914Z" fill="#CBCBCB"/>
<path d="M145.155 141.269L135.811 95.4851L131.707 61.6688L122.613 67.5514L123.869 104.817L138.383 143.428C137.917 144.316 137.725 145.323 137.833 146.321C137.94 147.319 138.342 148.262 138.986 149.031C139.631 149.799 140.49 150.359 141.454 150.638C142.418 150.918 143.443 150.904 144.399 150.6C145.355 150.295 146.199 149.713 146.823 148.927C147.448 148.142 147.824 147.188 147.905 146.188C147.986 145.188 147.768 144.186 147.278 143.31C146.789 142.435 146.049 141.724 145.155 141.269V141.269Z" fill="#FFB7B7"/>
<path d="M57.7642 144.81L60.3506 98.1533L59.4939 64.0995L71.5156 68.5972L73.5224 105.649L64.7777 145.96C65.3684 146.772 65.7046 147.74 65.7434 148.743C65.7822 149.745 65.522 150.737 64.9958 151.591C64.4696 152.446 63.7012 153.124 62.7883 153.541C61.8754 153.958 60.8592 154.093 59.869 153.931C58.8788 153.768 57.9593 153.315 57.2273 152.629C56.4954 151.942 55.9841 151.054 55.7585 150.076C55.5328 149.098 55.6031 148.075 55.9602 147.138C56.3174 146.2 56.9453 145.39 57.7642 144.81L57.7642 144.81Z" fill="#FFB7B7"/>
<path d="M82.942 280.458L89.0844 280.457L92.0068 256.764L82.9409 256.765L82.942 280.458Z" fill="#FFB7B7"/>
<path d="M81.375 278.451L93.4722 278.451H93.4727C95.5173 278.451 97.4781 279.263 98.9238 280.709C100.37 282.155 101.182 284.116 101.182 286.16V286.411L81.3754 286.411L81.375 278.451Z" fill="#2F2E41"/>
<path d="M106.208 277.738L112.278 278.677L118.789 255.71L109.83 254.324L106.208 277.738Z" fill="#FFB7B7"/>
<path d="M104.966 275.518L116.921 277.367L116.922 277.367C118.942 277.68 120.756 278.782 121.963 280.432C123.171 282.082 123.674 284.143 123.361 286.164L123.323 286.411L103.75 283.384L104.966 275.518Z" fill="#2F2E41"/>
<path d="M81.1375 273.383L81.1056 273.211L58.8683 152.981C57.103 143.329 58.5111 133.365 62.8816 124.58L76.341 97.6616L116.502 103.103L121.242 137.374L138.133 202.752L138.116 202.805L116.476 271.546L102.293 272.479L114.856 211.118L91.8517 158.868L93.4744 272.448L81.1375 273.383Z" fill="#2F2E41"/>
<path d="M117.438 107.488L117.172 107.073C117.125 106.998 112.246 99.6483 98.9712 104.556C85.4194 109.566 74.9187 99.8888 74.8142 99.7905L74.7622 99.7415L71.6931 72.3869L68.0701 50.1804L79.603 48.157L85.2731 44.7552L107.82 44.3538L113.753 49.0203L123.494 50.0819L124.386 70.316L124.382 70.3381L117.438 107.488Z" fill="#02C9D0"/>
<path d="M120.669 72.2732V54.9473L123.408 49.9481L123.52 49.9447C125.676 50.0251 127.714 50.9512 129.193 52.5225C131.948 55.3219 133.196 59.986 132.903 66.3851L132.897 66.5022L120.669 72.2732Z" fill="#02C9D0"/>
<path d="M72.9231 70.39L58.9615 68.7145L58.9505 68.5537C58.4742 61.5914 59.6895 56.4232 62.5625 53.1931C65.1699 50.2615 68.1576 50.084 68.2836 50.0779L68.3641 50.0741L72.1436 53.5099L72.9231 70.39Z" fill="#02C9D0"/>
<path d="M113.34 37.3724H76.6004C75.8447 37.3716 75.1202 37.071 74.5858 36.5366C74.0514 36.0022 73.7508 35.2777 73.75 34.522V21.2199C73.75 15.5921 75.9857 10.1947 79.9652 6.21517C83.9447 2.23566 89.3421 0 94.97 0C100.598 0 105.995 2.23566 109.975 6.21517C113.954 10.1947 116.19 15.5921 116.19 21.2199V34.522C116.189 35.2777 115.889 36.0022 115.354 36.5366C114.82 37.071 114.095 37.3716 113.34 37.3724V37.3724Z" fill="#2F2E41"/>
<path d="M109.474 29.1463C113.596 21.6069 110.825 12.154 103.285 8.03262C95.746 3.91124 86.293 6.68206 82.1717 14.2214C78.0503 21.7608 80.8211 31.2137 88.3605 35.335C95.8999 39.4564 105.353 36.6856 109.474 29.1463Z" fill="#FFB7B7"/>
<path d="M110.611 22.1701H90.0709C89.685 22.1696 89.3126 22.0284 89.0233 21.773C88.734 21.5176 88.5478 21.1655 88.4996 20.7826L88.2336 18.6553C88.208 18.4507 88.1167 18.26 87.9733 18.112C87.8298 17.9639 87.6422 17.8665 87.4385 17.8344C87.2349 17.8024 87.0264 17.8374 86.8444 17.9343C86.6624 18.0311 86.5169 18.1845 86.4298 18.3714L85.0832 21.2564C84.9552 21.529 84.7523 21.7596 84.4983 21.9214C84.2442 22.0831 83.9494 22.1694 83.6483 22.1701H80.5283C80.3076 22.1701 80.0893 22.1241 79.8874 22.0348C79.6856 21.9455 79.5047 21.815 79.3562 21.6517C79.2078 21.4884 79.0951 21.2958 79.0255 21.0864C78.9558 20.877 78.9307 20.6553 78.9518 20.4356L80.182 7.58573C80.2084 7.31081 80.3056 7.04745 80.4642 6.82138C80.6229 6.5953 80.8375 6.41427 81.087 6.29598C90.4937 1.90465 100.033 1.91021 109.44 6.31268C109.678 6.42484 109.885 6.59472 110.041 6.80695C110.198 7.01919 110.299 7.26708 110.336 7.5282L112.178 20.3614C112.211 20.586 112.194 20.8151 112.131 21.0329C112.067 21.2507 111.957 21.4522 111.808 21.6238C111.659 21.7953 111.475 21.9329 111.269 22.0272C111.062 22.1214 110.838 22.1702 110.611 22.1701L110.611 22.1701Z" fill="#2F2E41"/>
<path d="M145.203 144.194L144.436 143.427L177.771 110.091H242.372L274.966 76.8251H338.732L370.903 44.4033H520.661V45.4881H371.355L339.184 77.9098H275.421L242.828 111.176H178.221L145.203 144.194Z" fill="#3F3D56"/>
<path d="M276.052 97.6266C287.135 97.6266 296.12 88.642 296.12 77.5589C296.12 66.4758 287.135 57.4912 276.052 57.4912C264.969 57.4912 255.984 66.4758 255.984 77.5589C255.984 88.642 264.969 97.6266 276.052 97.6266Z" fill="white"/>
<path d="M371.509 50.4404C374.505 50.4404 376.933 48.0121 376.933 45.0167C376.933 42.0213 374.505 39.593 371.509 39.593C368.514 39.593 366.085 42.0213 366.085 45.0167C366.085 48.0121 368.514 50.4404 371.509 50.4404Z" fill="#CBCBCB"/>
<path d="M519.576 50.4404C522.572 50.4404 525 48.0121 525 45.0167C525 42.0213 522.572 39.593 519.576 39.593C516.581 39.593 514.153 42.0213 514.153 45.0167C514.153 48.0121 516.581 50.4404 519.576 50.4404Z" fill="#CBCBCB"/>
<path d="M445.814 50.4404C448.809 50.4404 451.238 48.0121 451.238 45.0167C451.238 42.0213 448.809 39.593 445.814 39.593C442.818 39.593 440.39 42.0213 440.39 45.0167C440.39 48.0121 442.818 50.4404 445.814 50.4404Z" fill="#CBCBCB"/>
<path d="M276.052 98.169C271.976 98.169 267.991 96.9603 264.602 94.6956C261.212 92.431 258.571 89.2121 257.011 85.4461C255.451 81.6801 255.043 77.5361 255.838 73.5381C256.633 69.5402 258.596 65.8678 261.478 62.9854C264.361 60.103 268.033 58.1401 272.031 57.3449C276.029 56.5496 280.173 56.9578 283.939 58.5177C287.705 60.0776 290.924 62.7193 293.188 66.1086C295.453 69.4979 296.662 73.4827 296.662 77.5589C296.656 83.0232 294.482 88.2618 290.619 92.1256C286.755 95.9894 281.516 98.1629 276.052 98.169ZM276.052 58.0336C272.19 58.0336 268.415 59.1788 265.204 61.3242C261.993 63.4697 259.491 66.5191 258.013 70.0869C256.535 73.6547 256.148 77.5806 256.902 81.3682C257.655 85.1557 259.515 88.6348 262.245 91.3655C264.976 94.0961 268.455 95.9557 272.243 96.7091C276.03 97.4625 279.956 97.0759 283.524 95.598C287.092 94.1202 290.141 91.6176 292.287 88.4066C294.432 85.1957 295.577 81.4207 295.577 77.5589C295.571 72.3823 293.512 67.4193 289.852 63.7589C286.191 60.0984 281.229 58.0394 276.052 58.0336V58.0336Z" fill="#3F3D56"/>
<path d="M276.052 91.8972C283.971 91.8972 290.39 85.4777 290.39 77.5589C290.39 69.6401 283.971 63.2206 276.052 63.2206C268.133 63.2206 261.713 69.6401 261.713 77.5589C261.713 85.4777 268.133 91.8972 276.052 91.8972Z" fill="#02C9D0"/>
<path d="M274.685 83.6118L270.394 78.0937L272.89 76.1526L274.922 78.7651L281.786 71.5186L284.081 73.6935L274.685 83.6118Z" fill="white"/>
<path d="M177.34 130.711C188.423 130.711 197.408 121.727 197.408 110.644C197.408 99.5604 188.423 90.5758 177.34 90.5758C166.257 90.5758 157.273 99.5604 157.273 110.644C157.273 121.727 166.257 130.711 177.34 130.711Z" fill="white"/>
<path d="M177.34 131.254C173.264 131.254 169.279 130.045 165.89 127.78C162.501 125.515 159.859 122.297 158.299 118.531C156.739 114.765 156.331 110.621 157.126 106.623C157.921 102.625 159.884 98.9524 162.767 96.07C165.649 93.1876 169.322 91.2247 173.32 90.4295C177.317 89.6342 181.461 90.0424 185.227 91.6023C188.993 93.1622 192.212 95.8039 194.477 99.1932C196.742 102.582 197.95 106.567 197.95 110.643C197.944 116.108 195.771 121.346 191.907 125.21C188.043 129.074 182.805 131.247 177.34 131.254ZM177.34 91.1182C173.479 91.1182 169.704 92.2633 166.493 94.4088C163.282 96.5543 160.779 99.6037 159.301 103.171C157.823 106.739 157.437 110.665 158.19 114.453C158.944 118.24 160.803 121.719 163.534 124.45C166.264 127.181 169.744 129.04 173.531 129.794C177.319 130.547 181.245 130.16 184.812 128.683C188.38 127.205 191.43 124.702 193.575 121.491C195.721 118.28 196.866 114.505 196.866 110.643C196.86 105.467 194.801 100.504 191.14 96.8435C187.48 93.183 182.517 91.124 177.34 91.1182V91.1182Z" fill="#3F3D56"/>
<path d="M177.34 124.982C185.259 124.982 191.679 118.562 191.679 110.643C191.679 102.725 185.259 96.3052 177.34 96.3052C169.422 96.3052 163.002 102.725 163.002 110.643C163.002 118.562 169.422 124.982 177.34 124.982Z" fill="#02C9D0"/>
<path d="M175.974 116.696L171.682 111.178L174.178 109.237L176.21 111.85L183.075 104.603L185.37 106.778L175.974 116.696Z" fill="white"/>
</g>
<defs>
<clipPath id="clip0">
<rect width="525" height="286.914" fill="white"/>
</clipPath>
</defs>
</svg>

            </div>
            <div class="text-left py-4" >
          <a href="#" @click="goHome" v-on:click.prevent><i class="fa fa-long-arrow-left" style="font-size: 50px; color: #132a5e"></i></a>
        </div>
            </div>
        </div>      
      </div>          
    </div>
</template>

<script>
const axios = require('axios');
import Navbar from "@/components/Navbar.vue"
import { mapGetters, mapActions, } from 'vuex'
export default {
  components: {
     Navbar
  },
  name: 'Checkout',
  data(){
    return {
      errorMessage: null,
      items: [],
    }
  },
  computed: {
    ...mapGetters([
      'getCart',
      'getOrder'
    ])
  },
  created(){
    if(this.getCart.length < 1){
      this.$router.push({ name: 'NotAllowed' })
    }
    else{
      this.getCart.forEach((value, index) => {    
        const item = {
          name: value.name,
          description: value.description,
          quantity: value.quantity,
          orderId: this.getOrder.id
        }
        this.items.push(item)    
      });
      this.createOrderItem(this.items); 
    }
  },
  methods: {
    ...mapActions([
      'emptyCart', 
      'emptyOrder'
    ]),
    goHome(){
      this.$router.push({ name: 'Home' })
    },
    createOrderItem(items){ 
      axios({
        method : 'post',
        url : process.env.VUE_APP_BACKEND_URL + "OrderItems",
         data : JSON.stringify(items),
        headers: {'Content-Type': 'application/json'},           
      })
      .then( () => {
        this.sendConfirmEmail(items);
        this.emptyCart();
        this.emptyOrder(); 
        setTimeout( () => this.$router.push({ name: 'Home'}), 5000);
      })
      .catch(error => {
        console.log(error); 
        this.$toast.error("Something went wrong, please try again.",
          {
            position:"bottom-right",
            duration: 4000,
          }
        );                       
      }); 
    },  
    sendConfirmEmail(items){
     axios({
        method : 'post',
        url : process.env.VUE_APP_BACKEND_URL + "SendEmail/SendConfirmOrderEmail?email=" + this.getOrder.email + "&UID=" + this.getOrder.uid + "&orderType=" + this.getOrder.deliveryType,
        data : JSON.stringify(items),
        headers: {'Content-Type': 'application/json'},           
      })
      .then( () => {
        setTimeout( () => this.$router.push({ name: 'Home'}), 5000);
      })
      .catch(error => {
        console.log(error); 
        this.$toast.error("Something went wrong, please try again.",
          {
            position:"bottom-right",
            duration: 4000,
          }
        );                       
      });   
    } 
  },
}
</script>

<style>

</style>